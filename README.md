# Docker Pipeline: Kallisto RNA Quantification

This repository contains a Docker-based pipeline designed to process RNA data using Kallisto for quantification within a containerized environment. The pipeline automates building, running, and managing the Docker container while handling data input and output directories.

## Table of Contents
1. [Overview](#overview)
2. [Prerequisites](#prerequisites)
3. [Pipeline Components](#pipeline-components)
4. [Usage](#usage)
    - [Build and Run the Pipeline](#build-and-run-the-pipeline)
    - [Cleanup Resources](#cleanup-resources)
5. [Directory and Volume Structure](#directory-and-volume-structure)
6. [Logging](#logging)
7. [Troubleshooting](#troubleshooting)

---

## Overview
The pipeline:
- Builds and runs a Docker container using the `kallisto-pipeline` image.
- Mounts Docker volumes for **transcripts** and **RNA data**.
- Maps a host output directory to collect results.
- Provides cleanup functionality to remove unused containers, images, and volumes.

## Prerequisites
To use this pipeline, ensure the following dependencies are installed:

1. **Docker**: Verify Docker is installed and running.
   - [Install Docker](https://docs.docker.com/get-docker/)
   - Verify installation with:
     ```bash
     docker --version
     ```
2. **Bash**: A bash shell is required to run the script.

## Pipeline Components
The pipeline includes the following key components:

- **Docker Image**: `kallisto-pipeline:latest`
- **Volumes**:
  - `transcripts_volume`: Stores transcripts data inside the container.
  - `rna_data_volume`: Stores RNA data inside the container.
- **Host Directory**: Default output directory on the host machine is `output`.
- **Main Script**: The container executes `/data/main.sh`.

## Usage
### Build and Run the Pipeline
Run the script to build and execute the pipeline:

```bash
./pipeline.sh
```

**Options:**
- **Host Output Directory**: To specify a custom output directory, set the `HOST_OUTPUT_DIR` environment variable:
  ```bash
  HOST_OUTPUT_DIR=my_output ./pipeline.sh
  ```

### Cleanup Resources
To remove all Docker resources (containers, images, and volumes) associated with the pipeline, use the `cleanup` argument:

```bash
./pipeline.sh cleanup
```

This will:
- Stop and remove containers.
- Remove the `kallisto-pipeline` Docker image.
- Delete the `transcripts_volume` and `rna_data_volume` Docker volumes.

## Directory and Volume Structure
The following directories and Docker volumes are utilized during execution:

| **Host Path/Volume**       | **Container Path**        | **Description**             |
|----------------------------|---------------------------|-----------------------------|
| `transcripts_volume`       | `/data/transcripts`       | Transcripts input data      |
| `rna_data_volume`          | `/data/rna_data`          | RNA input data              |
| `output` (default)         | `/data/output`            | Pipeline results            |

- Docker volumes `transcripts_volume` and `rna_data_volume` are persistent across runs.
- Host output directory (`output`) stores the results generated by the pipeline.

## Logging
The script uses colored logs for better readability:

- **INFO**: General informational messages.
- **SUCCESS**: Successful completion of steps.
- **WARN**: Warnings during execution.
- **ERROR**: Errors encountered during execution.

## Troubleshooting
### 1. Docker Not Found
**Error Message**:
```
[ERROR] Docker is not installed or not in PATH. Please install Docker first.
```
**Solution**: Install Docker and verify it is in your PATH.

### 2. Failed to Create Host Output Directory
**Error Message**:
```
[ERROR] Cannot create or write to host output directory: <path>
```
**Solution**: Ensure you have write permissions for the specified output directory.

### 3. Docker Image Build Failure
**Error Message**:
```
[ERROR] Failed to build Docker image 'kallisto-pipeline:latest'.
```
**Solution**:
- Check the `Dockerfile` for errors.
- Verify you have access to the necessary resources.
